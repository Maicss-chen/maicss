> {
>   "title": "GNU规范中tar超长文件名的处理",
>   "datetime": "2022年7月10日 8:48"
> }

在处理tar包时，发现若文件名长度过大时，最终解析到的文件名不完整，这是由于在tar的标头中，文件名的最大长度为100字节，超出则会溢出。

在GNU的规范中，标头`typeflag`字段为`L`时，则表示该节点的下一个节点有一个超长文件名，这时，当前节点的数据部分就是下一节点的文件名。例如：正常情况下文件AB在tar包中的排列是`A标头|A数据|B标头|B数据`，但当文件B的文件名过长时（超过100字节），排列就会变成这样：`A标头|A数据|B文件名标头|B文件名|B标头|B数据`，也就是说，过长的文件名被单独做成一个节点放在了原来B文件节点的前边。

这个原理了解过后，对于超长文件名的处理就很容易了。但前提是，若使用tar命令进行打包，需要确定`format`选项为`gnu`。可以使用`--help`选项查看默认的值，比如我的是：

```text
此 tar 默认为:
--format=gnu -f- -b20 --quoting-style=escape --rmt-command=/usr/sbin/rmt
--rsh-command=/usr/bin/rsh
```

更具体的内容请看我翻译的上一篇文章：[翻译：GNU tar 格式](post.html#Tar.md)